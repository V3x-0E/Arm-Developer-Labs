---
layout: page
type: article
---

{%- include snippets/assign.html
  target = site.data.variables.default.page.sharing
  source0=layout.sharing source1=page.sharing -%}
{%- assign _sharing = __return -%}

<div class="layout--article">
  {%- include article/top/custom.html -%}

  <div class="article__content" itemprop="articleBody">
    {{ content }}

    {%- if page.filter == "project" -%}
      <!-- 1) Checkbox filters -->
      <div class="subjects">
        {%- assign nav_group = site.data.navigation["projects"] -%}

        <div class="search search--bright">
          <div class="main">
            <div class="search-bar">
              <div class="search-box js-search-box not-empty">
                <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
                <input type="text" class="">
                <div class="search-box__icon-clear js-icon-clear">
                  <a><i class="fas fa-times"></i></a>
                </div>
              </div>
            </div>
            <div class="search-result js-search-result"></div>
          </div>
        </div>

        <!-- Platform -->
        <div class="filter">
          <strong>Platform:</strong>
          {%- assign platforms = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for p in item.platform -%}
                {%- unless platforms contains p -%}
                  {%- assign platforms = platforms | push: p -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for platform in platforms -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="platform" value="{{ platform }}" onchange="filterProjects()">
              {{ platform }}
            </label>
          {%- endfor -%}
        </div>

        <!-- Subject -->
        <div class="filter">
          <strong>Subject:</strong>
          {%- assign subjects = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for s in item.subjects -%}
                {%- unless subjects contains s -%}
                  {%- assign subjects = subjects | push: s -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for subject in subjects -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="subject" value="{{ subject }}" onchange="filterProjects()">
              {{ subject }}
            </label>
          {%- endfor -%}
        </div>

        <!-- SW/HW -->
        <div class="filter">
          <strong>SW/HW:</strong>
          {%- assign swhw_items = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for tag in item["sw-hw"] -%}
                {%- unless swhw_items contains tag -%}
                  {%- assign swhw_items = swhw_items | push: tag -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for tag in swhw_items -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="sw-hw" value="{{ tag }}" onchange="filterProjects()">
              {{ tag }}
            </label>
          {%- endfor -%}
        </div>

        <!-- Support Level -->
        <div class="filter">
          <strong>Support Level:</strong>
          {%- assign levels = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for lvl in item["support-level"] -%}
                {%- unless levels contains lvl -%}
                  {%- assign levels = levels | push: lvl -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for lvl in levels -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="support-level" value="{{ lvl }}" onchange="filterProjects()">
              {{ lvl }}
            </label>
          {%- endfor -%}
        </div>
      </div>

      <!-- 2) Twoâ€section project list -->
      <div class="project-results">
        {%- assign nav_root = site.data.navigation["projects"] -%}
        {%- for category in nav_root -%}
          <h2 class="project-group-title">{{ category.title }}</h2>
          <ul class="project-list">
            {%- for _child in category.children -%}
              {%- include snippets/get-nav-url.html path=_child.url -%}
              {%- assign _nav_url = __return -%}

              {%- comment -%}
              Normalize URL so it matches how site.posts/pages store .url
              (no site.url, no baseurl)
              {%- endcomment -%}
              {%- assign _nav_url_rel = _nav_url
                   | replace: site.url, ''
                   | replace: site.baseurl, '' -%}

              {%- comment -%}
              Resolve badges:
              1) Prefer badges from navigation data (_child.badges)
              2) If not present, look up the matching post/page by URL
                 and read its front-matter badges
              {%- endcomment -%}
              {%- assign _badges = _child.badges -%}
              {%- if _badges == nil or _badges == empty -%}
                {%- assign _doc = site.posts | where: "url", _nav_url_rel | first -%}
                {%- unless _doc -%}{%- assign _doc = site.pages | where: "url", _nav_url_rel | first -%}{%- endunless -%}
                {%- if _doc and _doc.badges -%}{%- assign _badges = _doc.badges -%}{%- endif -%}
              {%- endif -%}

              <li class="project-item"
                  data-platforms='{{ _child.platform | jsonify }}'
                  data-subjects='{{ _child.subjects | jsonify }}'
                  data-swhw='{{ _child["sw-hw"] | jsonify }}'
                  data-support-level='{{ _child["support-level"] | jsonify }}'
                  {%- if _badges -%} data-badges='{{ _badges | jsonify }}'{%- endif -%}
                  data-url-rel='{{ _nav_url_rel }}'>

               <header class="project-header">
  <a class="project-title" href="{{ _nav_url }}">{{ _child.title }}</a>

  {%- if _badges -%}
    <div class="project-badges">
      {% include badges.html items=_badges %}
    </div>
  {%- endif -%}
</header>


                <p class="project-desc">
                  {{ _child.description }}
                </p>
              </li>
            {%- endfor -%}
          </ul>
        {%- endfor -%}
      </div>

  <script>
(function(){
  // --- Utilities ---
  function safeParseBadges(raw) {
    raw = raw === undefined || raw === null ? '[]' : String(raw);
    raw = raw.trim();
    // Already JSON?
    try {
      const parsed = JSON.parse(raw);
      if (Array.isArray(parsed)) return parsed.map(s=>String(s).trim());
      // if parsed is an object, try to read keys as badges (unlikely)
    } catch(e){}
    // Try comma-separated fallback
    if (raw === '' || raw === '[]') return [];
    // remove wrapping quotes/brackets if weird
    const cleaned = raw.replace(/^[\[\]'" ]+|[\[\]'" ]+$/g,'');
    return cleaned.split(',').map(s => s.trim()).filter(Boolean);
  }

  function norm(arr) {
    return (arr||[]).map(x => String(x).trim().toLowerCase());
  }

  function badgeRankFromNorm(normed) {
    const isTrending = normed.includes('trending');
    const isRecent = normed.includes('recently_added') || normed.includes('recently-added') || normed.includes('recentlyadded');
    if (isTrending && isRecent) return 0;
    if (isRecent) return 1;
    if (isTrending) return 2;
    return 3;
  }

  // --- main sorter (stable) ---
  function sortAllProjectLists() {
    document.querySelectorAll('.project-list').forEach(ul => {
      const items = Array.from(ul.querySelectorAll(':scope > .project-item'));
      const decorated = items.map((el, idx) => {
        const rawBadges = el.getAttribute('data-badges') || el.dataset.badges || '[]';
        const parsed = safeParseBadges(rawBadges);
        const normed = norm(parsed);
        const rank = badgeRankFromNorm(normed);
        return { el, idx, rank, normed };
      });

      // diagnostics: log counts
      const counts = decorated.reduce((acc,d)=>{ acc[d.rank]= (acc[d.rank]||0)+1; return acc; },{});
      console.info('project-list:', ul, 'counts by rank:', counts);

      // stable sort
      decorated.sort((a,b) => a.rank - b.rank || a.idx - b.idx);

      // Re-append in order (moves nodes)
      decorated.forEach(d => ul.appendChild(d.el));

      // diagnostic: show any element that claims trending but ended up after a lower-priority item
      const finalOrder = Array.from(ul.querySelectorAll(':scope > .project-item'));
      // find first index of any non-trending group (rank>2) and any trending after it
      const indexOfFirstNonTop = finalOrder.findIndex(li => {
        const p = safeParseBadges(li.getAttribute('data-badges') || li.dataset.badges || '[]');
        const nn = norm(p);
        const r = badgeRankFromNorm(nn);
        return r > 2; // 3 = neither; treat >2 as lower priority than trending
      });
      if (indexOfFirstNonTop > -1) {
        finalOrder.forEach((li, i) => {
          const p = norm(safeParseBadges(li.getAttribute('data-badges') || li.dataset.badges || '[]'));
          const r = badgeRankFromNorm(p);
          if ((p.includes('trending') || p.includes('recently_added')) && i > indexOfFirstNonTop && r <= 2) {
            console.warn('Possible misplacement: trending/recent item appears after lower-priority items:', {li, index:i, rank:r, badges:p});
          }
        });
      }
    });
  }

  // --- watch for mutations and re-sort ---
  const observer = new MutationObserver(muts => {
    // If any childList changed inside a project-results container, re-sort after microtask to let other scripts settle
    let shouldSort = false;
    for (const m of muts) {
      if (m.type === 'childList' || m.type === 'attributes') shouldSort = true;
    }
    if (shouldSort) {
      // small debounce
      if (observer._timer) clearTimeout(observer._timer);
      observer._timer = setTimeout(() => {
        try { sortAllProjectLists(); } catch(e){ console.error(e); }
      }, 75);
    }
  });

  function startObserving() {
    const container = document.querySelector('.project-results') || document.body;
    observer.observe(container, { childList: true, subtree: true, attributes: true, attributeFilter: ['data-badges'] });
  }

  // run on load and start observer
  document.addEventListener('DOMContentLoaded', () => {
    try { sortAllProjectLists(); } catch(e){ console.error(e); }
    // run again short delays to catch late scripts
    setTimeout(sortAllProjectLists, 200);
    setTimeout(sortAllProjectLists, 800);
    startObserving();
  });

  // expose helpers for debugging in console
  window.__arm_debug_sortAllProjectLists = sortAllProjectLists;
  window.__arm_debug_parseBadges = safeParseBadges;
  window.__arm_debug_norm = norm;
})();
</script>


    {%- endif -%}
  </div>

  {%- if _sharing -%}
    <section class="article__sharing d-print-none">{%- include sharing.html -%}</section>
  {%- endif -%}

  <div class="d-print-none">
    {%- include article-footer.html -%}
  </div>
</div>





