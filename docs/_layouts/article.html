---
layout: page
type: article
---

{%- include snippets/assign.html
  target = site.data.variables.default.page.sharing
  source0=layout.sharing source1=page.sharing -%}
{%- assign _sharing = __return -%}

<div class="layout--article">
  {%- include article/top/custom.html -%}

  <div class="article__content" itemprop="articleBody">
    {{ content }}

    {%- if page.filter == "project" -%}
      <!-- 1) Checkbox filters -->
      <div class="subjects">
        {%- assign nav_group = site.data.navigation["projects"] -%}

        <div class="search search--bright">
          <div class="main">
            <div class="search-bar">
              <div class="search-box js-search-box not-empty">
                <div class="search-box__icon-search"><i class="fas fa-search"></i></div>
                <input type="text" class="">
                <div class="search-box__icon-clear js-icon-clear">
                  <a><i class="fas fa-times"></i></a>
                </div>
              </div>
            </div>
            <div class="search-result js-search-result"></div>
          </div>
        </div>

        <!-- Platform -->
        <div class="filter">
          <strong>Platform:</strong>
          {%- assign platforms = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for p in item.platform -%}
                {%- unless platforms contains p -%}
                  {%- assign platforms = platforms | push: p -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for platform in platforms -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="platform" value="{{ platform }}" onchange="filterProjects()">
              {{ platform }}
            </label>
          {%- endfor -%}
        </div>

        <!-- Subject -->
        <div class="filter">
          <strong>Subject:</strong>
          {%- assign subjects = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for s in item.subjects -%}
                {%- unless subjects contains s -%}
                  {%- assign subjects = subjects | push: s -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for subject in subjects -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="subject" value="{{ subject }}" onchange="filterProjects()">
              {{ subject }}
            </label>
          {%- endfor -%}
        </div>

        <!-- SW/HW -->
        <div class="filter">
          <strong>SW/HW:</strong>
          {%- assign swhw_items = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for tag in item["sw-hw"] -%}
                {%- unless swhw_items contains tag -%}
                  {%- assign swhw_items = swhw_items | push: tag -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for tag in swhw_items -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="sw-hw" value="{{ tag }}" onchange="filterProjects()">
              {{ tag }}
            </label>
          {%- endfor -%}
        </div>

        <!-- Support Level -->
        <div class="filter">
          <strong>Support Level:</strong>
          {%- assign levels = "" | split: "" -%}
          {%- for grp in nav_group -%}
            {%- for item in grp.children -%}
              {%- for lvl in item["support-level"] -%}
                {%- unless levels contains lvl -%}
                  {%- assign levels = levels | push: lvl -%}
                {%- endunless -%}
              {%- endfor -%}
            {%- endfor -%}
          {%- endfor -%}
          {%- for lvl in levels -%}
            <label>
              <input type="checkbox" class="filter-checkbox" data-category="support-level" value="{{ lvl }}" onchange="filterProjects()">
              {{ lvl }}
            </label>
          {%- endfor -%}
        </div>
      </div>

      <!-- 2) Twoâ€section project list -->
      <div class="project-results">
        {%- assign nav_root = site.data.navigation["projects"] -%}
        {%- for category in nav_root -%}
          <h2 class="project-group-title">{{ category.title }}</h2>
          <ul class="project-list">
            {%- for _child in category.children -%}
              {%- include snippets/get-nav-url.html path=_child.url -%}
              {%- assign _nav_url = __return -%}

              {%- comment -%}
              Normalize URL so it matches how site.posts/pages store .url
              (no site.url, no baseurl)
              {%- endcomment -%}
              {%- assign _nav_url_rel = _nav_url
                   | replace: site.url, ''
                   | replace: site.baseurl, '' -%}

              {%- comment -%}
              Resolve badges:
              1) Prefer badges from navigation data (_child.badges)
              2) If not present, look up the matching post/page by URL
                 and read its front-matter badges
              {%- endcomment -%}
              {%- assign _badges = _child.badges -%}
              {%- if _badges == nil or _badges == empty -%}
                {%- assign _doc = site.posts | where: "url", _nav_url_rel | first -%}
                {%- unless _doc -%}{%- assign _doc = site.pages | where: "url", _nav_url_rel | first -%}{%- endunless -%}
                {%- if _doc and _doc.badges -%}{%- assign _badges = _doc.badges -%}{%- endif -%}
              {%- endif -%}

              <li class="project-item"
                  data-platforms='{{ _child.platform | jsonify }}'
                  data-subjects='{{ _child.subjects | jsonify }}'
                  data-swhw='{{ _child["sw-hw"] | jsonify }}'
                  data-support-level='{{ _child["support-level"] | jsonify }}'
                  {%- if _badges -%} data-badges='{{ _badges | jsonify }}'{%- endif -%}
                  data-url-rel='{{ _nav_url_rel }}'>

               <header class="project-header">
  <a class="project-title" href="{{ _nav_url }}">{{ _child.title }}</a>

  {%- if _badges -%}
    <div class="project-badges">
      {% include badges.html items=_badges %}
    </div>
  {%- endif -%}
</header>


                <p class="project-desc">
                  {{ _child.description }}
                </p>
              </li>
            {%- endfor -%}
          </ul>
        {%- endfor -%}
      </div>

   <script>
  // Robust badge-aware sorting:
  // Group order:
  // 0 = trending + recently_added
  // 1 = recently_added only
  // 2 = trending only
  // 3 = neither
  // - normalizes badge strings (trim + lower)
  // - tolerates missing/malformed data-badges
  // - logs items with unparsable badges for debugging

  function readBadgesNormalized(li) {
    const raw = li.getAttribute('data-badges') || '[]';
    let arr;
    try {
      arr = JSON.parse(raw);
      if (!Array.isArray(arr)) arr = [];
    } catch (e) {
      // Try a fallback: sometimes badges are rendered as a single string
      try {
        const text = String(raw).trim();
        if (text.startsWith('[') && text.endsWith(']')) {
          // last resort: try to eval-ish (NOT recommended normally, but safe-ish here as a fallback)
          arr = JSON.parse(text.replace(/([a-zA-Z0-9_-]+)\s*:/g, '"$1":')); // attempt to help malformed
        } else if (text === '') {
          arr = [];
        } else {
          // split on commas if it looks like "a, b, c"
          arr = text.split(',').map(s => s.trim()).filter(Boolean);
        }
      } catch (e2) {
        console.warn('Could not parse data-badges for', li, raw);
        arr = [];
      }
    }
    // normalize (trim + lowercase)
    return arr.map(x => String(x).trim().toLowerCase());
  }

  function computeBadgeRank(badges) {
    const isTrending = badges.includes('trending');
    const isRecent = badges.includes('recently_added') || badges.includes('recently-added') || badges.includes('recentlyadded');
    if (isTrending && isRecent) return 0;
    if (isRecent) return 1;
    if (isTrending) return 2;
    return 3;
  }

  function sortProjectsCustom() {
    document.querySelectorAll('.project-list').forEach(ul => {
      const items = Array.from(ul.querySelectorAll(':scope > .project-item'));
      const decorated = items.map((el, idx) => {
        const badges = readBadgesNormalized(el);
        const rank = computeBadgeRank(badges);
        return { el, idx, rank };
      });

      decorated.sort((a, b) => {
        if (a.rank !== b.rank) return a.rank - b.rank;
        return a.idx - b.idx; // stable sort: keep original order within same rank
      });

      // append in sorted order (this moves elements rather than cloning)
      decorated.forEach(d => ul.appendChild(d.el));
    });
  }

  // Fix for filterProjects: dataset property name for support level is data-support-level,
  // so dataset property is "supportLevel" (camelCase). Use getAttribute fallback to be safe.
  function getDataArray(li, attrName, datasetKey) {
    // prefer dataset (handles camelCase) but fallback to attribute
    const ds = li.dataset && li.dataset[datasetKey];
    const raw = ds !== undefined ? ds : li.getAttribute(attrName) || '[]';
    try {
      const parsed = JSON.parse(raw);
      return Array.isArray(parsed) ? parsed : [];
    } catch (e) {
      // fallback to comma-separated
      return String(raw).split(',').map(s => s.trim()).filter(Boolean);
    }
  }

  function filterProjects() {
    const checks = Array.from(document.querySelectorAll('.filter-checkbox:checked'));
    if (checks.length === 0) {
      document.querySelectorAll('.project-item').forEach(el => el.style.display = '');
      return;
    }
    const activeFilters = checks.map(cb => ({ cat: cb.dataset.category, val: cb.value }));
    document.querySelectorAll('.project-item').forEach(li => {
      const plats   = getDataArray(li, 'data-platforms', 'platforms');
      const subs    = getDataArray(li, 'data-subjects', 'subjects');
      const swhws   = getDataArray(li, 'data-swhw', 'swhw');
      const levels  = getDataArray(li, 'data-support-level', 'supportLevel'); // fallback-safe
      const ok = activeFilters.every(f => {
        switch (f.cat) {
          case 'platform':      return plats.includes(f.val);
          case 'subject':       return subs.includes(f.val);
          case 'sw-hw':         return swhws.includes(f.val);
          case 'support-level': return levels.includes(f.val);
          default:              return true;
        }
      });
      li.style.display = ok ? '' : 'none';
    });
  }

  // If you suspect another script mutates the list after DOMContentLoaded,
  // run the sorter again a short time later to re-enforce ordering.
  // Run immediately on DOMContentLoaded, and again after a brief delay.
  document.addEventListener('DOMContentLoaded', () => {
    try { sortProjectsCustom(); } catch (e) { console.error(e); }
    // re-run after 250ms and 1000ms to catch late mutations (safe, small overhead)
    setTimeout(sortProjectsCustom, 250);
    setTimeout(sortProjectsCustom, 1000);
  });

  // expose functions for debugging from console
  window.__arm_sortProjectsCustom = sortProjectsCustom;
  window.__arm_readBadgesNormalized = readBadgesNormalized;
</script>

    {%- endif -%}
  </div>

  {%- if _sharing -%}
    <section class="article__sharing d-print-none">{%- include sharing.html -%}</section>
  {%- endif -%}

  <div class="d-print-none">
    {%- include article-footer.html -%}
  </div>
</div>




